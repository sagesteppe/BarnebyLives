library(BarnebyLives)
label_writer(collection_examples)
collection_examples
label_writer(collection_examples)
)
coords <- data.frame(
longitude_dd = rep(42.3456, times = 5),
latitude_dd = rep((-116.7890, times = 5)
)
coords <- data.frame(
longitude_dd = rep(42.3456, times = 5),
latitude_dd = rep(-116.7890, times = 5)
)
View(coords)
)
coords <- data.frame(
longitude_dd = c(rep(42.3456, times = 5), 43.3456),
latitude_dd = c(rep(-116.7890, times = 5), -117.7890)
)
View(coords)
coords <- data.frame(
longitude_dd = c(rep(42.3456, times = 5), 43.3456),
latitude_dd = c(rep(-116.7890, times = 5), -115.7890)
)
View(coords)
gsub('[.].*$', '', 42.3456)
gsub('[.]*$', '', 42.3456)
gsub('.*\\.', , 42.3456)
gsub('.*\\.', '', 42.3456)
gsub('.*\\.', '', 42.3456)
gsub('.*\\.', '', 42.3456)
gsub('^.*[.]', '', 42.3456)
gsub('[.].*$', '', 42.3456)
?lag
coords <- data.frame(
longitude_dd = c(rep(42.3456, times = 5), 43.3456),
latitude_dd = c(rep(-116.7890, times = 5), -115.7890)
)
coords |>
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd) )
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd) )
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd) ) |>
dplyr::group_by(long_decimals, lat_decimals) %>%
mutate(
'Long_Flag' = dplyr::lag(long_degree, n = 1))
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd) ) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
'Long_Flag' = dplyr::lag(long_degree, n = 1))
scrambled <- slice_sample(
tibble(year = 2000:2005, value = (0:5) ^ 2),
prop = 1
)
library(dplyr)
scrambled <- slice_sample(
tibble(year = 2000:2005, value = (0:5) ^ 2),
prop = 1
)
wrong <- mutate(scrambled, previous_year_value = lag(value))
arrange(wrong, year)
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
'Long_Flag' = dplyr::lag(long_degree, n = 1))
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
)
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
)
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = ifelse(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  ifelse(lat_degree == lat_degree_last, NA, 'Flagged')
)
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = dplyr::ifelse(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  dplyr::ifelse(lat_degree == lat_degree_last, NA, 'Flagged')
)
?ifelse
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = dplyr::if_else(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  dplyr::if_else(lat_degree == lat_degree_last, NA, 'Flagged')
)
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = dplyr::if_else(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  dplyr::if_else(lat_degree == lat_degree_last, NA, 'Flagged')
)
t <- coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = dplyr::if_else(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  dplyr::if_else(lat_degree == lat_degree_last, NA, 'Flagged')
)
View(t)
}
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = dplyr::if_else(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  dplyr::if_else(lat_degree == lat_degree_last, NA, 'Flagged')
) |>
dplyr::select(Long_AutoFill_Flag, Lat_AutoFill_Flag)
coords <- data.frame(
longitude_dd = c(rep(42.3456, times = 5), 43.3456),
latitude_dd = c(rep(-116.7890, times = 5), -115.7890)
)
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = dplyr::if_else(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  dplyr::if_else(lat_degree == lat_degree_last, NA, 'Flagged')
) |>
dplyr::select(Long_AutoFill_Flag, Lat_AutoFill_Flag)
coords |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = dplyr::if_else(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  dplyr::if_else(lat_degree == lat_degree_last, NA, 'Flagged')
) |>
dplyr::ungroup() |>
dplyr::select(Long_AutoFill_Flag, Lat_AutoFill_Flag)
?last_col
coords <- data.frame(
longitude_dd = c(rep(42.3456, times = 5), 43.3456),
latitude_dd = c(rep(-116.7890, times = 4), -115.7890, -116.7890)
)
#' Spreadsheets like to automatically increment everything all the time.
#' Here we try to detect these where they may affect 'year' or the latitude
#' or longitude of a collection
#' @param x a dataframe which has undergone 'dms2dd' from BarnebyLives
#' @example
#' coords <- data.frame(
#'   longitude_dd = c( rep(42.3456, times = 5), 43.3456),
#'   latitude_dd = c( rep((-116.7890, times = 5), -115.7890)
#' )
#' @export
autofill_increment_checker <- function(x){
}
}
}
}
}
}
}
autofill_increment_checker <- function(x){
flags <- x |>
dplyr::mutate(
long_decimals = gsub('.*\\.', '', longitude_dd),
lat_decimals  = gsub('.*\\.', '', latitude_dd),
long_degree = gsub('[.].*$', '', longitude_dd),
lat_degree  = gsub('[.].*$', '', latitude_dd),
) |>
dplyr::group_by(long_decimals, lat_decimals) |>
dplyr::mutate(
long_deg_last = dplyr::lag(long_degree),
lat_degree_last = dplyr::lag(lat_degree),
Long_AutoFill_Flag = dplyr::if_else(long_degree == long_deg_last, NA, 'Flagged'),
Lat_AutoFill_Flag  =  dplyr::if_else(lat_degree == lat_degree_last, NA, 'Flagged')
) |>
dplyr::ungroup() |>
dplyr::select(Long_AutoFill_Flag, Lat_AutoFill_Flag)
output <- dplyr::bind_cols(x, flags) |>
dplyr::relocate(Long_AutoFill_Flag, Lat_AutoFill_Flag, .after = last_col())
return(output)
}
coords <- data.frame(
longitude_dd = c(rep(42.3456, times = 5), 43.3456),
latitude_dd = c(rep(-116.7890, times = 4), -115.7890, -116.7890)
)
autofill_increment_checker(coords)
}
