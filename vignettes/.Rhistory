colnames(out_ob) <- new_names
return(out_ob)
}
dat_out <- powo_searcher(data$Full_name)
#' notes: results are observed to fail for valid infraspecies on Kew's end, and they seem not
#' to mention valid infraspecies.
#' @examples
#' library(dplyr)
#' pow_results <- lapply(
#'       c('Linnaea borealis var. borealis', 'Astragalus purshii', 'Pinus ponderosa'),
#'       powo_searcher) |>
#'    dplyr::bind_rows()
#' head(pow_results)
#' @export
powo_searcher <- function(x){
x <- trimws(gsub("\\s+", " ", x))
query_results <- kewr::search_powo(x)
if (is.null(query_results[["results"]])) {
second_try <- try_again(query_results)
if (is.null(second_try[["results"]])) {
taxonomic_info <- data.frame(
family = as.character(),
name_authority = as.character(),
full_name = as.character(),
genus = as.character(),
epithet = as.character(),
infrarank = as.character(),
infraspecies = as.character(),
authority = as.character()
)
taxonomic_info[1,] <- 'NOT FOUND'
} else {
results_to_process <- second_try
}
} else {
results_to_process <- query_results
}
# this is the end of the process, return empty results without error, or real results
if (exists('taxonomic_info')) {
out_ob <- data.frame(cbind(query = x, taxonomic_info))
} else {
taxonomic_info <- result_grabber(results_to_process)
out_ob <- data.frame(cbind(query = x, taxonomic_info))
}
new_names <-  paste0('POW', '_',
stringr::str_to_sentence( colnames(out_ob) ))
colnames(out_ob) <- new_names
return(out_ob)
}
dat_out <- powo_searcher(data$Full_name)
names <- sf::st_drop_geometry(data) %>%
pull(Full_name)
dat_out <- lapply(names,
powo_searcher)
pow_res <- bind_rows(dat_out)
View(pow_res)
devtools::install_github('sagesteppe/BarnebyLives')
# devtools::install_github('sagesteppe/BarnebyLives')
library(tidyverse)
library(BarnebyLives)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
df <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Data Entry - Examples') %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
rm(processed, df)
data <- date_parser(input, 'Date_digital')
dplyr::select(data, starts_with('Date')) %>%
utils::head()
data <- dms2dd(data, dms = F)
dplyr::select(data, starts_with(c('latitude', 'longitude'))) %>%
utils::head()
data <- coords2sf(data)
head(data) # now we can see that it is an sf object
p <- '/media/steppe/hdd/Barneby_Lives-dev/geodata'
data <- political_grabber(data, y = 'Collection_number', path = p)
data <- site_writer(data, path = p)
data <- physical_grabber(data, path = p)
p <- '/media/steppe/hdd/Barneby_Lives-dev/taxonomic_data'
data <- spell_check(data, path = p)
data <- dms2dd(data, dms = F)
dplyr::select(data, starts_with(c('latitude', 'longitude'))) %>%
utils::head()
View(data)
p <- '/media/steppe/hdd/Barneby_Lives-dev/geodata'
data <- political_grabber(data, y = 'Collection_number', path = p)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
df <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Data Entry - Examples') %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
rm(processed, df)
data <- date_parser(input, 'Date_digital')
dplyr::select(data, starts_with('Date')) %>%
utils::head()
data <- dms2dd(data, dms = F)
dplyr::select(data, starts_with(c('latitude', 'longitude'))) %>%
utils::head()
data <- coords2sf(data)
head(data) # now we can see that it is an sf object
p <- '/media/steppe/hdd/Barneby_Lives-dev/geodata'
data <- political_grabber(data, y = 'Collection_number', path = p)
data <- site_writer(data, path = p)
data <- physical_grabber(data, path = p)
p <- '/media/steppe/hdd/Barneby_Lives-dev/taxonomic_data'
data <- spell_check(data, path = p)
names <- sf::st_drop_geometry(data) %>%
pull(Full_name)
dat_out <- lapply(names,
powo_searcher)
dat_out <- lapply(names,
powo_searcher)
pow_res <- bind_rows(dat_out)
View(pow_res)
View(pow_res)
bind_cols(data, pow_res)
data <- bind_cols(data, pow_res)
View(data)
SoS_gkey = Sys.getenv("Sos_gkey")
directions <- directions_grabber(data, api_key = SoS_gkey)
View(directions)
View(directions)
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
df <- sf::st_drop_geometry(directions) %>%
select(processed)
df <- sf::st_drop_geometry(directions) %>%
select(all_of(processed))
View(data)
View(dat_out)
View(pow_res)
data <- author_check(data, path = p)
View(data)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
df <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Data Entry - Examples') %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
rm(processed, df)
data <- date_parser(input, 'Date_digital')
dplyr::select(data, starts_with('Date')) %>%
utils::head()
data <- dms2dd(data, dms = F)
dplyr::select(data, starts_with(c('latitude', 'longitude'))) %>%
utils::head()
data <- coords2sf(data)
head(data) # now we can see that it is an sf object
p <- '/media/steppe/hdd/Barneby_Lives-dev/geodata'
data <- political_grabber(data, y = 'Collection_number', path = p)
data <- site_writer(data, path = p)
data <- physical_grabber(data, path = p)
p <- '/media/steppe/hdd/Barneby_Lives-dev/taxonomic_data'
data <- spell_check(data, path = p)
data <- author_check(data, path = p)
names <- sf::st_drop_geometry(data) %>%
pull(Full_name)
pow_res <- lapply(names,
powo_searcher) %>%
bind_rows()
data <- bind_cols(data, pow_res)
rm(names, pow_res)
SoS_gkey = Sys.getenv("Sos_gkey")
directions <- directions_grabber(data, api_key = SoS_gkey)
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
df <- sf::st_drop_geometry(directions) %>%
select(all_of(processed))
View(data)
View(data)
# devtools::install_github('sagesteppe/BarnebyLives')
library(tidyverse)
library(BarnebyLives)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
df <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Data Entry - Examples') %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
rm(processed, df)
data <- date_parser(input, 'Date_digital')
dplyr::select(data, starts_with('Date')) %>%
utils::head()
data <- dms2dd(data, dms = F)
dplyr::select(data, starts_with(c('latitude', 'longitude'))) %>%
utils::head()
data <- coords2sf(data)
head(data) # now we can see that it is an sf object
p <- '/media/steppe/hdd/Barneby_Lives-dev/geodata'
data <- political_grabber(data, y = 'Collection_number', path = p)
data <- site_writer(data, path = p)
data <- physical_grabber(data, path = p)
p <- '/media/steppe/hdd/Barneby_Lives-dev/taxonomic_data'
data <- spell_check(data, path = p)
data <- author_check(data, path = p)
names <- sf::st_drop_geometry(data) %>%
pull(Full_name)
pow_res <- lapply(names,
powo_searcher) %>%
bind_rows()
data <- bind_cols(data, pow_res)
rm(names, pow_res)
SoS_gkey = Sys.getenv("Sos_gkey")
directions <- directions_grabber(data, api_key = SoS_gkey)
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
processed
df <- sf::st_drop_geometry(directions) %>%
select(all_of(processed))
df <- sf::st_drop_geometry(directions) %>%
select(any_of(processed))
View(df)
# we will add these data onto our final sheet.  THIS IS THE LAST STEP OF THIS TUTORIAL
sheet_append('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples', data = df)
df <- sf::st_drop_geometry(directions) %>%
select(all_of(processed))
processed <- processed[! processed %in% c('POW_Binomial_authority', 'POW_Infraspecific_authority')]
df <- sf::st_drop_geometry(directions) %>%
select(all_of(processed))
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
processed <- processed[! processed %in% c('POW_Binomial_authority', 'POW_Infraspecific_authority')]
df <- sf::st_drop_geometry(directions) %>%
select(all_of(processed))
# we will add these data onto our final sheet.  THIS IS THE LAST STEP OF THIS TUTORIAL
sheet_append('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples', data = df)
load("/media/steppe/hdd/BarnebyLives/data/collection_examples.rda")
View(collection_examples)
gc()
load("/media/steppe/hdd/BarnebyLives/data/project_examples.rda")
View(project_examples)
load("/media/steppe/hdd/BarnebyLives/data/shipping_examples.rda")
View(shipping_examples)
#'
#' This is a small data frame of species information for use with the shipping/transferal notes
#' as well as with the label makers.
#'
#' this data frame is derived from collections in 2023, which have been cleaned with the
#' BarnebyLives pipeline
#'
#' @format A data frame with some collections which will one day be shipped.
#' @examples
#' head(collection_examples)
"collection_examples"
View(shipping_examples)
library(usethis)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
# read in data from the sheet to process
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
# read in data from the sheet to process
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples')
View(processed)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
df <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Data Entry - Examples') %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
rm(processed, df)
data <- date_parser(input, 'Date_digital')
dplyr::select(data, starts_with('Date')) %>%
utils::head()
data <- dms2dd(data, dms = F)
dplyr::select(data, starts_with(c('latitude', 'longitude'))) %>%
utils::head()
data <- coords2sf(data)
head(data) # now we can see that it is an sf object
p <- '/media/steppe/hdd/Barneby_Lives-dev/geodata'
data <- political_grabber(data, y = 'Collection_number', path = p)
# devtools::install_github('sagesteppe/BarnebyLives')
library(tidyverse)
library(BarnebyLives)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
df <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Data Entry - Examples') %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
rm(processed, df)
data <- date_parser(input, 'Date_digital')
dplyr::select(data, starts_with('Date')) %>%
utils::head()
data <- dms2dd(data, dms = F)
dplyr::select(data, starts_with(c('latitude', 'longitude'))) %>%
utils::head()
data <- coords2sf(data)
head(data) # now we can see that it is an sf object
p <- '/media/steppe/hdd/Barneby_Lives-dev/geodata'
data <- political_grabber(data, y = 'Collection_number', path = p)
data <- site_writer(data, path = p)
data <- physical_grabber(data, path = p)
p <- '/media/steppe/hdd/Barneby_Lives-dev/taxonomic_data'
data <- spell_check(data, path = p)
data <- author_check(data, path = p)
names <- sf::st_drop_geometry(data) %>%
pull(Full_name)
pow_res <- lapply(names,
powo_searcher) %>%
bind_rows()
data <- bind_cols(data, pow_res)
rm(names, pow_res)
SoS_gkey = Sys.getenv("Sos_gkey")
directions <- directions_grabber(data, api_key = SoS_gkey)
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
df <- sf::st_drop_geometry(directions) %>%
select(all_of(processed))
# we will add these data onto our final sheet.
sheet_append('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples', data = df)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples')
View(processed)
# devtools::install_github('sagesteppe/BarnebyLives')
library(tidyverse)
library(BarnebyLives)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
df <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Data Entry - Examples') %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
rm(processed, df)
View(input)
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
library(googlesheets4)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
df <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Data Entry - Examples') %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
# determine whether these data have already been processed by the script, using
# a unique combination of collection name and collection code.
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
select(Collection_number, Primary_Collector) %>%
mutate(UNIQUEID = paste0(Primary_Collector, Collection_number))
input <- filter(df, ! UNIQUEID %in% processed$UNIQUEID ) %>%
select(-UNIQUEID)
rm(processed, df)
data <- date_parser(input, 'Date_digital')
dplyr::select(data, starts_with('Date')) %>%
utils::head()
data <- dms2dd(data, dms = F)
dplyr::select(data, starts_with(c('latitude', 'longitude'))) %>%
utils::head()
data <- coords2sf(data)
head(data) # now we can see that it is an sf object
p <- '/media/steppe/hdd/Barneby_Lives-dev/geodata'
data <- political_grabber(data, y = 'Collection_number', path = p)
data <- site_writer(data, path = p)
data <- physical_grabber(data, path = p)
p <- '/media/steppe/hdd/Barneby_Lives-dev/taxonomic_data'
data <- spell_check(data, path = p)
data <- author_check(data, path = p)
names <- sf::st_drop_geometry(data) %>%
pull(Full_name)
pow_res <- lapply(names,
powo_searcher) %>%
bind_rows()
data <- bind_cols(data, pow_res)
rm(names, pow_res)
SoS_gkey = Sys.getenv("Sos_gkey")
directions <- directions_grabber(data, api_key = SoS_gkey)
# first ensure the columns are in the same order as google sheets
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples') %>%
colnames()
df <- sf::st_drop_geometry(directions) %>%
select(all_of(processed))
# we will add these data onto our final sheet.
sheet_append('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples', data = df)
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples')
usethis::use_data(processed, 'collection_examples')
googledrive::drive_auth("reedbenkendorf27@gmail.com")
# read in data from the sheet to process
processed <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples')
usethis::use_data(processed, 'collection_examples')
?use_data
usethis::use_data(processed, 'collection_examples')
# read in data from the sheet to process
collection_examples <- read_sheet('1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M',
sheet = 'Processed - Examples')
usethis::use_data(processed)
devtools::install_github('sagesteppe/BarnebyLives')
# devtools::install_github('sagesteppe/BarnebyLives')
library(BarnebyLives)
data('collection_examples')
setwd('~/Documents/HerbariumLabels')
p2libs <- .libPaths()[
grepl(paste0(version$major, '.', sub('\\..*', "", version$minor)),
.libPaths())]
folds <- c('BarnebyLives/rmarkdown/templates/labels/skeleton/skeleton.Rmd')
purrr::walk(
.x = collection_examples$Collection_number,
~ rmarkdown::render(
input = file.path( p2libs, folds),
output_file = glue::glue("{.x}.pdf"),
params = list(fullname = {.x})
)
)
View(collection_examples)
devtools::install_github('sagesteppe/BarnebyLives')
# devtools::install_github('sagesteppe/BarnebyLives')
library(BarnebyLives)
data('collection_examples')
setwd('~/Documents/HerbariumLabels')
p2libs <- .libPaths()[
grepl(paste0(version$major, '.', sub('\\..*', "", version$minor)),
.libPaths())]
folds <- c('BarnebyLives/rmarkdown/templates/labels/skeleton/skeleton.Rmd')
purrr::walk(
.x = collection_examples$Collection_number,
~ rmarkdown::render(
input = file.path( p2libs, folds),
output_file = glue::glue("{.x}.pdf"),
params = list(fullname = {.x})
)
)
