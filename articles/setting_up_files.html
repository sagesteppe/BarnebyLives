<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Preparing to use BarnebyLives! • BarnebyLives</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparing to use BarnebyLives!">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BarnebyLives</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/creating_labels.html">Printing herbarium labels and exporting a digital copy of data</a></li>
    <li><a class="dropdown-item" href="../articles/custom_label_templates.html">Custom Label Templates</a></li>
    <li><a class="dropdown-item" href="../articles/rendering_shipping_manifests.html">Rendering a shipping manifest</a></li>
    <li><a class="dropdown-item" href="../articles/running_pipeline.html">BarnebyLives! Running pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/setting_up_files.html">Preparing to use BarnebyLives!</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Preparing to use BarnebyLives!</h1>
            
      

      <div class="d-none name"><code>setting_up_files.Rmd</code></div>
    </div>

    
    
<p>BarnebyLives relies on a variety of data to be downloaded locally to
your computer to work. My instance, which covers a large area,
essentially from Michigan to California, South through Texas to the
Canadian border is around 16GiB. Many more regional collections are
likely to be in the realm of 4-10 GiB, so relative to a normal R package
A LOT of data. Relative to a typical geospatial workflow…. Essentially
no data. Given how much larger the amount of disk data are on computers
I think this amount is trivial to consider.</p>
<p>It’s important that you decide where BarnebyLives will be installed
on your computer. While I have couple computers, I maintain only a
single instance of BarnebyLives. It lives on one of my 3.5 terabyte hard
drives which I have set up for various science projects.</p>
<p>I will be downloading and copying some of the data to that location,
where I have a directory named ‘Barneby_Lives-dev’.</p>
<div class="section level3">
<h3 id="helper-functions">Helper functions<a class="anchor" aria-label="anchor" href="#helper-functions"></a>
</h3>
<p>Unfortunately, setting up a BL instance is not totally automated by
the package. The data come from a wide variety of sources, and there are
two which I cannot for the life of me figure out how to download from.
One is a very strange Minio server, if you are a minio expert please
make an issue in the GH repo and let’s try and figure this out!</p>
</div>
<div class="section level3">
<h3 id="taxonomic-data">Taxonomic Data<a class="anchor" aria-label="anchor" href="#taxonomic-data"></a>
</h3>
<p><strong>Worldwide Checklist of Vascular Plants</strong> provides the
local taxonomic information required to perform much of the name
matching. We utilize it to ensure that queries sent to <strong>Plants of
The World Online</strong> are spelled correctly, in order to reduce the
number of queries we make to it. “The World Checklist of Vascular
Plants, a continuously updated resource for exploring global plant
diversity” serves as the basis for Kews Plants of the Worlds, this
publication details the process behind the data set. This is not that
large of a file, so it will be downloaded in a couple minutes.</p>
<p>This function will simply take the name of the output directory where
we would like to save our data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/TaxUnpack.html">TaxUnpack</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">'/media/steppe/hdd/BL_sandbox/taxdata-MI'</span>, bound <span class="op">=</span> <span class="va">bound</span><span class="op">)</span></span></code></pre></div>
<p>The way that BarnebyLives matches spellings of names is very simple.
It creates three tables, one large table which contains all of the
species in the WFO database, one moderately small table which contains
all infraspecific taxa (varieties and subspecies), and a small table of
all of the genera.</p>
<p>However, both the genus and specific epithet tables are abbreviated.
We find the results from these tables based on only the leading first
two or three characters. This gives rises to one of BarnebyLives(!)
limitations, the assumption that the first two characters of the genus,
and first three letters of the specific epithet are spelled
correctly.</p>
<p>Now we will also prepare the author abbreviations data set. These
data come from <a href="https://www.ipni.org/" class="external-link">IPNI</a>, and were
minimally processed on my end, see the script within the data-raw
directory on github for details. We will save a copy of them in the
taxonomy directory as well.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'ipni_authors'</span>, package<span class="op">=</span><span class="st">'BarnebyLives'</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="st">'/media/steppe/hdd/BL_sandbox/taxdata-MI'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">ipni_authors</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p2</span>, <span class="st">'ipni_author_abbreviations.csv'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-all-geographic-data-and-set-up-an-instance">Download all geographic data and set up an instance<a class="anchor" aria-label="anchor" href="#download-all-geographic-data-and-set-up-an-instance"></a>
</h3>
<p>The package has one function, <code>data_download</code> which is
able to download <em>most</em> of the data you need automatically. A
second function <code>tile_selector</code> will help you determine which
files you need to download manually.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I am using R markdown so want to be really sure save data to the correct location</span></span>
<span><span class="co"># so I will use an absolute path</span></span>
<span><span class="fu"><a href="../reference/data_download.html">data_download</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">'/media/steppe/hdd/BL_sandbox/raw_data'</span><span class="op">)</span> </span>
<span><span class="co"># if you are using an interactive R script. (file.R) you should be able to do something</span></span>
<span><span class="co"># similar or even just cd into the directory where you want to save everything and </span></span>
<span><span class="co"># run the function ala `download-data()`</span></span></code></pre></div>
<p>We will define a geographic extent that covers our area of interest.
It will be a simple square, and grabbing coordinates from Open Street
Maps, or a similar service, will suffice.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bound</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>   y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">48</span>,  <span class="fl">48</span>,  <span class="fl">41</span>,  <span class="fl">41</span>,  <span class="fl">48</span><span class="op">)</span>,</span>
<span>   x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">91</span>, <span class="op">-</span><span class="fl">82</span>, <span class="op">-</span><span class="fl">82</span>, <span class="op">-</span><span class="fl">91</span>, <span class="op">-</span><span class="fl">91</span><span class="op">)</span></span>
<span> <span class="op">)</span> <span class="co"># note that the 5th pair of coordinates is the same</span></span>
<span><span class="co"># as the first pair (48, -91), this is required to 'close'</span></span>
<span><span class="co"># the square. </span></span>
<span></span>
<span><span class="fu"><a href="../reference/tileSelector.html">tileSelector</a></span><span class="op">(</span><span class="va">bound</span><span class="op">)</span></span></code></pre></div>
<p>We will download a few attributes from Geomorpho90m from a <a href="https://opentopography.s3.sdsc.edu/minio/dataspace/OTDS.012020.4326.1/raster/" class="external-link">Minio</a>
page. We need both ‘aspect’ (NOT ‘sine’ or ‘cosine’) and ‘geom’ from
here, you should be able to control find these in their respective
directories and manually download them quickly. Once the files are
downloaded copy them to the same location as you had
<code>data_download</code> save files.</p>
<p>Halfway there! Now we also need to manually download data on
elevation from <a href="https://hydro.iis.u-tokyo.ac.jp/~yamadai/MERIT_DEM/" class="external-link">MERIT-DEM</a>.
Yes you technically need to register here, but you will automatically
get a log in password to any email you enter, and it works! These tiles
follow the same naming convention as the formed data set - in fact the
previous data set is derived from this one. Also save these files to the
location you have <code>data_download</code> save files.</p>
<p>Now that you have all of the data we can set up an instance, to do
this all we need to do is run the following function. Specify where the
downloaded data are ‘path’, where to save the date ‘pathOut’, the square
(or bounding box) around your study area ‘bound’, and whether to remove
the raw downloaded files ‘cleanup’. I always leave cleanup = FALSE,
until I am 100% certain that everything is all good, which means running
data through the pipeline and printing labels a couple times.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/data_setup.html">data_setup</a></span><span class="op">(</span> <span class="co"># this one will take maybe 30 minutes or so - can't recall but a start</span></span>
<span>  <span class="co"># and walk away or do emails type event. </span></span>
<span>  path <span class="op">=</span> <span class="st">'/media/steppe/hdd/BL_sandbox/geodata_raw'</span>, </span>
<span>  pathOut <span class="op">=</span> <span class="st">'/media/steppe/hdd/BL_sandbox/geodata-MI'</span>,</span>
<span>  bound <span class="op">=</span> <span class="va">bound</span>, cleanup <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="finishing-up-">Finishing up.<a class="anchor" aria-label="anchor" href="#finishing-up-"></a>
</h2>
<p>And that’s it! After a few runs of the system feel free to delete the
raw data, you can do that by hand, or by initializing the instance using
the ‘data_setup’ function; but that kind of seems like overkill!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Reed Clark Benkendorf.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
