<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Printing herbarium labels and exporting a digital copy of data • BarnebyLives</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Printing herbarium labels and exporting a digital copy of data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BarnebyLives</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/creating_labels.html">Printing herbarium labels and exporting a digital copy of data</a></li>
    <li><a class="dropdown-item" href="../articles/rendering_shipping_manifests.html">Rendering a shipping manifest</a></li>
    <li><a class="dropdown-item" href="../articles/running_pipeline.html">BarnebyLives! Running pipeline</a></li>
    <li><a class="dropdown-item" href="../articles/setting_up_files.html">Preparing to use BarnebyLives!</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Printing herbarium labels and exporting a digital copy of data</h1>
            
      

      <div class="d-none name"><code>creating_labels.Rmd</code></div>
    </div>

    
    
<p>This vignette will show you how to create your herbarium labels. It
also details how to export the data from the BarnebyLives format to some
other popular herbarium database formats.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::install_github('sagesteppe/BarnebyLives')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sagesteppe.github.io/BarnebyLives/">BarnebyLives</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'collection_examples'</span><span class="op">)</span></span></code></pre></div>
<p>You will need to create a directory (folder) where your labels will
be placed. Here we create a directory named “HerbariumLabels” in our
local Documents directory. This directory is where our final labels are
going to end up. We also need to create a subdirectory named ‘raw’, this
is where the initial output labels, generated by R interacting with your
TeX distribution will be written to. Each label is made individually,
and then later mosaiced (like tiles) onto pages for printing.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">'~/Documents'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">'HerbariumLabels'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">'HerbariumLabels/raw'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="st">'~/Documents/HerbariumLabels/raw'</span></span></code></pre></div>
<p>You can use a <code>purrr</code> function, <code>walk</code>, to
write many labels one after another in the following fashion. Be sure to
specify reasonable paths to write to! BL will create a temporary ‘raw’
file in location, which will store the intermediary labels.</p>
<p>Before you let <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::walk</a></code> through the labels to make,
you can copy the label template to a more easily accessible location on
your computer. This following code chunk below will search for your
current version of R, and then we can bring the template over from the
BarnebyLives directory which holds the package. As mentioned
BarnebyLives is a weirdo of an r package, so we are also specifying the
location within the package which holds the actual template (‘skeleton’)
which we will populate our labels values into.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2libs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'BarnebyLives'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>   <span class="st">'rmarkdown'</span>, <span class="st">'templates'</span>, <span class="st">'labels'</span>, <span class="st">'skeleton'</span>, <span class="st">'skeleton.Rmd'</span><span class="op">)</span></span></code></pre></div>
<p>In this example we are going to use the default BarnebyLives template
to create some labels. You can create your own label template as well,
that is discussed in the vignette “Custom Label Templates”. As mentioned
we will use purrr::walk(), this function is going to perform an
operation on each record which is feed into it via the <code>.x</code>
argument. While we are specifying the individual rows of our collections
in this document, purrr::walk() is going to call another function
<code><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">rmarkdown::render</a></code>, which will load the data for these
records from a csv into an R session, and write the labels from there.
Note that Collection_numbers are essential to making this happen, if you
are really trying to magyver some things, then you can fake this value
using another ID which is UNIQUE for each record here, and matches what
is in the BL output csv data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">collection_examples</span><span class="op">$</span><span class="va">Collection_number</span>,</span>
<span>  <span class="op">~</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span></span>
<span>    input <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p2libs</span>, <span class="va">folds</span><span class="op">)</span>, </span>
<span>    <span class="co"># the template which will be populated</span></span>
<span>    output_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{.x}.pdf"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    <span class="co"># the location and name for the output file. </span></span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Collection_number <span class="op">=</span> <span class="op">{</span><span class="va">.x</span><span class="op">}</span><span class="op">)</span> </span>
<span>    <span class="co"># this is what purrr will walk through - the collection numbers. </span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As I suspect that many users will want to create a custom label
template, I show how easy it is to modify the above function calls
below.</p>
<p>It will be best practice to make a copy of the template, and save it
in a part of the computer which people are more likely to interface
with, e.g. within the Documents directory. If you make a modified copy
of the template in the R package, whenever the package get’s updated and
you reinstall it, your template will be erased! It is very unlikely you
will be able to get a template back after it’s removed, so don’t do
this!</p>
<p>Using the code below we can simply copy (<code>file.copy</code>) the
template to the current working directory (supplied as argument:
‘.’).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p2libs</span>, <span class="va">folds</span><span class="op">)</span>, to <span class="op">=</span>  <span class="st">'.'</span><span class="op">)</span></span></code></pre></div>
<p>As mentioned we will showcase some template changes in a different
vignette, “Custom Label Templates”, but we will just use this default
template again for this example. Now from that location you can run the
script again, but this time with modification to the ‘input’ argument of
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::walk</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span></span>
<span>  .x <span class="op">=</span> <span class="va">collection_examples</span><span class="op">$</span><span class="va">Collection_number</span>,</span>
<span>  <span class="op">~</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/render.html" class="external-link">render</a></span><span class="op">(</span></span>
<span>    input <span class="op">=</span> <span class="st">'skeleton.Rmd'</span>, <span class="co"># specifying the location of our new template! </span></span>
<span>    <span class="co"># R is assuming it is in our current working directory, and will fail if it is</span></span>
<span>    <span class="co"># not found!</span></span>
<span>    output_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"{.x}.pdf"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Collection_number <span class="op">=</span> <span class="op">{</span><span class="va">.x</span><span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As you can see you only need to change a single argument in the above
code chunk to use a custom label - just let this
<code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::walk()</a></code> know where to find the template, and you
should be good.</p>
<div class="section level2">
<h2 id="exporting-a-digital-copy-of-the-data">Exporting a digital copy of the data<a class="anchor" aria-label="anchor" href="#exporting-a-digital-copy-of-the-data"></a>
</h2>
<p>This is normally the time when I also make a digital copy of the data
for direct accessioning at the herbarium side.</p>
<p>Currently BL supports writing out data for mass upload in a few
formats for herbaria(e.g. Symbiota, Jepson, Chicago Botanic Garden), but
we are always eager to add more, so <em>PLEASE</em> do not hesitate to
ask if you want something to be supported! There is a lot of code, but
realistically all it is doing is replacing NA values with ’’, or empty
contents, this is the best format for people to get NULL values for
their databases.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">database_templates</span><span class="op">$</span><span class="va">Database</span><span class="op">)</span> <span class="co"># currently supported options. </span></span>
<span></span>
<span><span class="va">dat_import</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_database_import.html">format_database_import</a></span><span class="op">(</span><span class="va">collection_examples</span>, <span class="st">'Symbiota'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> <span class="co"># KEEP THIS AROUND! Instead of writing explicit NA's # we</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span> <span class="co"># just return blank cells, this helps with import on most</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>, <span class="co"># users ends. </span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">~</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">''</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">dat_import</span>, <span class="st">'Symbiota_format_collections_2024.csv'</span>, row.names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Reed Clark Benkendorf.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
