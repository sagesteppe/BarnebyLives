<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BarnebyLives! Running pipeline • BarnebyLives</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BarnebyLives! Running pipeline">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BarnebyLives</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../data-sources.html">Alternative Data Sources</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>BarnebyLives! Running pipeline</h1>
            
      

      <div class="d-none name"><code>running_pipeline.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a>
</h2>
<p>The purpose of this script is to assist botanical collectors in
accessioning their collections. It is the central component of this
entire package. Here we will go over ensuring that values which will be
printed onto herbarium labels and uploaded into databases are
accurate.</p>
<p>It is our experience that many herbaria now request digital copies of
collection information in their own format. This script aims to
alleviate the investment in time this requires, and in doing so allow
the collector more time to do less onerous tasks; such as collection and
study.</p>
<p>While in theory all of the tasks in this script could be automated,
doing so would be an unconscionable action against local taxonomic
authorities. While several database options for updating collections
(and spell checking names) which are current and well curated (e.g. Kew
Plants of the World) exist, we feel many proposals and combinations
require interpretation by those in the regions attempting to understand
the material at hand.</p>
<p>This script will perform the following tasks.</p>
<div class="section level4">
<h4 id="geographic">Geographic<a class="anchor" aria-label="anchor" href="#geographic"></a>
</h4>
<p><strong>1)</strong> Convert coordinates to a Decimal Degrees format,
if needed (e.g. from DMS 72*17.55 -&gt; 72.29861).<br><strong>2)</strong> Retrieve appropriate political place names.
(i.e. State, County).<br><strong>3)</strong> Retrieve accurate elevation values of
coordinates.<br><strong>4)</strong> Retrieve Public Land Ownership (e.g. United States
Forest Service, Bureau of Land Management).<br><strong>5)</strong> Project coordinates from one system to another, if
needed (e.g. from an UTM zone to WGS84).<br><strong>6)</strong> Retrieve Cadastral data from the PLSS for Township,
Range, Section (TRS)</p>
</div>
<div class="section level4">
<h4 id="temporal">Temporal<a class="anchor" aria-label="anchor" href="#temporal"></a>
</h4>
<p><strong>1)</strong> Provide a ‘written’ date in the style of
choosing. (e.g. 12th May 2021), for the purpose of labeling.</p>
</div>
<div class="section level4">
<h4 id="taxonomic">Taxonomic<a class="anchor" aria-label="anchor" href="#taxonomic"></a>
</h4>
<p><strong>1)</strong> Provide a ‘spell check’ for family.<br><strong>2)</strong> Provide a ‘spell check’ for genus.<br><strong>3)</strong> Provide a ‘spell check’ for epithet.<br><strong>4)</strong> Provide a ‘spell check’ for authorities.<br><strong>5)</strong> In addition you may check for synonymy at each of
these taxonomic levels, and accept or reject suggestions.</p>
</div>
<div class="section level4">
<h4 id="directions">Directions<a class="anchor" aria-label="anchor" href="#directions"></a>
</h4>
<p>I preface this with the observation that a good deal of collectors
and curators consider these data non-essential now. Regardless, if you
are so inclined to gain access to a free google maps account these
services are provided.</p>
<p><strong>1)</strong> Write directions, from a town of notable size or
repute, to the closet parking spot to the collection locality.</p>
<p>Note that these directions may not reflect the actual route traveled
by the collectors, but rather what Google Maps thinks is optimal - at
the time of the query. <em>Caveat emptor.</em></p>
</div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>Files required to use this script:</p>
<ul>
<li>PAD-US database for retrieving land ownership information if needed
(<em>note does not include identities of Private owners</em>).</li>
<li>World Flora Online static copy of the database.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># devtools::install_github('sagesteppe/BarnebyLives')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sagesteppe.github.io/BarnebyLives/">BarnebyLives</a></span><span class="op">)</span></span></code></pre></div>
<p>In this example I am going to showcase loading the data we want to
run through the pipeline using Google Sheets. This can allow for
collectors on a team to readily contribute to preparing and transcribing
notes for an expedition simultaneously. Loading data in from a local CSV
or excel type file is as easy as <code>read.csv</code> or
<code><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">readxl::read_excel</a></code> instead.</p>
<p>We will use the package <code>googlesheets4</code>, which is a part
of the tidyverse, but which does not install by default with the
remainder of the ’verse. We will feed in the last part of the URL as the
link to the path. If this is your first time using
<code>googlesheets4</code>, it will walk you through a few steps to log
into your google account so you can access data securely. After that
<code>googlesheets4</code> is actually really straightforward to use,
note that I use the <code>drive_auth</code> function here. This function
makes non-interactive use easy, it is only used here because the
vignette renders as a non-interactive format.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages('googlesheets4')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org" class="external-link">googlesheets4</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">googledrive</span><span class="fu">::</span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_auth.html" class="external-link">drive_auth</a></span><span class="op">(</span><span class="st">"reedbenkendorf27@gmail.com"</span><span class="op">)</span></span>
<span><span class="co"># read in data from the sheet to process</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="st">'1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M'</span>, </span>
<span>                    sheet <span class="op">=</span> <span class="st">'Data Entry - Examples'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>UNIQUEID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Primary_Collector</span>, <span class="va">Collection_number</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="only-process-data-which-have-not-yet-run-through-the-pipeline-">only process data which have not yet run through the pipeline.<a class="anchor" aria-label="anchor" href="#only-process-data-which-have-not-yet-run-through-the-pipeline-"></a>
</h4>
<p>BarnebyLives takes a little bit of time to run, and it also requires
the usage of Google Developer credits for the directions portion. You
may want to ensure that you are not re-running files which you have
already processed. We can do that very simply using a combination of
collectors name’s and their collection numbers. If you are processing
for many many people at once, and worried people may have the same
names, and be collecting in the same range of numbers, then you can add
in other data which would be required to make a UNIQUEID, most likely a
component of the date.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># determine whether these data have already been processed by the script, using</span></span>
<span><span class="co"># a unique combination of collection name and collection code. </span></span>
<span><span class="co"># these are the data which have gone through the pipeline already</span></span>
<span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="st">'1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M'</span>,</span>
<span>                        sheet <span class="op">=</span> <span class="st">'Processed - Examples'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Collection_number</span>, <span class="va">Primary_Collector</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>UNIQUEID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">Primary_Collector</span>, <span class="va">Collection_number</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># here we look for any 'input' files which are present in the processed files and </span></span>
<span><span class="co"># drop them. </span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="op">!</span> <span class="va">UNIQUEID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">processed</span><span class="op">$</span><span class="va">UNIQUEID</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">UNIQUEID</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">processed</span>, <span class="va">df</span><span class="op">)</span></span></code></pre></div>
<p>Even though I coded this functionality, I essentially never use it.
The reason being that I don’t use the directions that much, and just get
up to start a cup of tea when the pipeline is running.</p>
</div>
<div class="section level3">
<h3 id="ensure-coordinates-and-dates-and-formatted-appropriately">Ensure Coordinates and Dates and formatted appropriately<a class="anchor" aria-label="anchor" href="#ensure-coordinates-and-dates-and-formatted-appropriately"></a>
</h3>
<p>Date parsing, e.g. convert date into congruent museum formats (month
in roman numerals, or spelled out). This step assumes that you are
recording your dates in the American format of (month/day/year), rather
than the internationally more common format (day/month/year). We will
also parse out the day of month, month of year, and year, which is used
in multiple possible downstream software.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/date_parser.html">date_parser</a></span><span class="op">(</span><span class="va">input</span>, coll_date <span class="op">=</span> <span class="st">'Date_digital'</span>, det_date <span class="op">=</span> <span class="st">'Determined_date'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'Date'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="conversion-of-degrees-minutes-seconds-dms-to-decimal-degrees-dd-">Conversion of Degrees Minutes Seconds (DMS) to Decimal Degrees
(DD).<a class="anchor" aria-label="anchor" href="#conversion-of-degrees-minutes-seconds-dms-to-decimal-degrees-dd-"></a>
</h4>
<p>The DMS format is still used in a few applications we will convert
this to the more generally utilized DD format. Although DMS is certainly
prettier to read, DD is just used so much more often we change
everything to it. Sad. We will maintain both formats in the data set, so
others have them readily available for other uses aside from creating
herbarium labels.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dms2dd.html">dms2dd</a></span><span class="op">(</span><span class="va">data</span>, dms <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'latitude'</span>, <span class="st">'longitude'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Several spreadsheet software auto-increment numeric columns by
default. We try to identify that issue here.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/autofill_checker.html">autofill_checker</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">Long_AutoFill_Flag</span>, <span class="va">Lat_AutoFill_Flag</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>For internal usage and data acquisition we will make data set
explicitly spatial, rather than just holding coordinates in a column.
This is also required to write out data in a format readable by Google
Earth or another Geographic Information System.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/coords2sf.html">coords2sf</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="co"># now we can see that it is an sf object</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="retrieve-politicaladministrative-information">Retrieve Political/Administrative Information<a class="anchor" aria-label="anchor" href="#retrieve-politicaladministrative-information"></a>
</h3>
<p>BarnebyLives! will retrieve various components of both political and
administrative information. All of these data which include: The
<em>state</em>, and <em>county</em> of collection, and the <em>township,
range, section (TRS)</em> from the Public Land Survey System (PLSS). It
will also determine whether a Federal or State Agency manages or owns
the land which were collected from, and if so return the name of it. If
either the United States Forest Service or Bureau of Land Management
does manage the land, it will return information on grazing
allotments.</p>
<p>Retrieve State, County, Ownership, TRS, and allotment information</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="st">'/media/steppe/hdd/Barneby_Lives-dev/geodata'</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/political_grabber.html">political_grabber</a></span><span class="op">(</span><span class="va">data</span>, y <span class="op">=</span> <span class="st">'Collection_number'</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="geographic-information-for-locality-info">Geographic Information for Locality info<a class="anchor" aria-label="anchor" href="#geographic-information-for-locality-info"></a>
</h3>
<p>Many younger collectors use Site Names which are quite broad, we
advocate for the usage of locality names.</p>
<p>A locality name is going to provide the relation between a site and
the actual collection area through a distance and azimuth. All of the
sites which we use as prospective identifiers are from the Geographic
Names Information System, these names have undergone standardization,
and general cleaning up to better reflect currently acceptable naming
practices (i.e. misogynistic and racist names have largely - if not
entirely - been removed). Using GNIS allows for places to be
unambiguously related to each other. While I hate saying that a
collection site is XX km from a river at 121 degrees, because well -
just think about it, that seems to be what people want.</p>
<p>Retrieve Nearest GNIS place name, and azimuth from it.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/site_writer.html">site_writer</a></span><span class="op">(</span><span class="va">data</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="site-characteristics">Site characteristics<a class="anchor" aria-label="anchor" href="#site-characteristics"></a>
</h3>
<p>BarnebyLives acquires a range of characteristics which are useful to
describe the physical environment, these are: elevation (both meters and
feet), slope, aspect, surficial geology, and geomorphons.</p>
<p>While most of BarnebyLives is dedicated towards addressing the peeves
of curators with too much time on their hands, this module is for me.
What I generally see, if people even both to describe the site at all,
is that they are laser focused on a tiny micro-environment that they
collected the individual plant in - not the characteristics of the
population or even the general area of the population they are seeing. I
don’t dislike these notes, in fact I find them of the utmost value.
However, even those inclusions exist within a broader context, which is
doing much habitat filtering in and of itself, and without this relation
the obscurity of these certain habitats can be lost.</p>
<p>Here are some details on some of the data sets which we are using.
All elevation data come from <a href="https://www.earthenv.org/DEM" class="external-link">DEM90</a>, as the name implies this
data set is at roughly 90 meters of roughly in the X and Y dimensions.
This product is then used to derive both slope (in degrees) and aspect
(in degrees) information. Slope conveys the change in elevation between
adjacent cells, while aspect discusses which way water would flow
downslope. An aspect of East states that water would flow downslope to
the east. Surficial geology data are acquired from the United States
Geological Survey, it works very well for characterizing major geology
types in an area, although you may be on a minor inclusion within that
material. Geomorphons are a bit more peculiar, they may refer to several
things, but here they refer to <a href="https://www.sciencedirect.com/science/article/abs/pii/S0169555X12005028" class="external-link">10
standardized landform positions</a> <a href="https://portal.opentopography.org/dataspace/dataset?opentopoID=OTDS.012020.4326.1" class="external-link">Geomorpho90m</a>,
which are useful for characterizing landform position. These are useful
for spatial ecology and describe where on the landscape the population
was broadly located. Generally ‘Valleys’ tend to eat up more land cover
than they should, often extending up into alluvial fans, but I find them
very useful for describing roughly where on the landscape the population
is.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/physical_grabber.html">physical_grabber</a></span><span class="op">(</span><span class="va">data</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="taxonomic-1">Taxonomic<a class="anchor" aria-label="anchor" href="#taxonomic-1"></a>
</h3>
<p>BarnebyLives performs multiple operations related to taxonomy and
nomenclature. The function <strong>spell_check()</strong>, will attempt
to determine whether the supplied binomial scientific name, and family
are spelled correctly and offer suggestions if they are not.</p>
<p>This function requires that the first few letters of the generic name
and epithet are spelled correctly. It will run a spell check against
nearly all published plant name spellings, and search for the most
similar spelling within these lists if material is not found. It will
operate on both pieces of the binomial separately, and can work to
identify the species within the context of genus.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="st">'/media/steppe/hdd/Barneby_Lives-dev/taxonomic_data'</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spell_check.html">spell_check</a></span><span class="op">(</span><span class="va">data</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spell_check.html">spell_check</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, column <span class="op">=</span> <span class="st">'Full_name'</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/family_spell_check.html">family_spell_check</a></span><span class="op">(</span><span class="va">data</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p>A similar check is to determine that the author whom is cited for
describing the species, or transferring it to another genus, is spelled
using the standard author abbreviations. This check operates under a
similar manner to <strong>spell_check()</strong>. The list which is
consults <em>is</em> comprehensive, within a few years, of all
taxonomists whom have published plant species.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/author_check.html">author_check</a></span><span class="op">(</span><span class="va">data</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p>The final process in the taxonomic step is to ensure that the
spellings of any species noted in the <em>vegetation</em>, or
<em>associates</em> fields are accurate. These <em>will not</em> then be
submitted to Kew, as the fields could quickly overwhelm the API.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/associates_spell_check.html">associates_spell_check</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">'Associates'</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span> <span class="co"># we can run on both columns. </span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/associates_spell_check.html">associates_spell_check</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">'Vegetation'</span>, path <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span></code></pre></div>
<p>Remove the collected species from the list of associated species.
Many collectors will include the focal collection in the list of
associated species when performing data entry for a site. We can remove
it here.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/associate_dropper.html">associate_dropper</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">'Full_name'</span>, col  <span class="op">=</span> <span class="st">'Associates'</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/associate_dropper.html">associate_dropper</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">'Full_name'</span>, col  <span class="op">=</span> <span class="st">'Vegetation'</span><span class="op">)</span></span></code></pre></div>
<p>After BarnebyLives! has verified the spelling of the species it will
submit it to Plants of the World Online to determine whether a more
current and accepted name has been applied. BL! will not automatically
over-write your submitted species, and it is important that you
interpret the results of query. Especially as it is possible that
<strong>spell_check</strong> has mis-matched your material to another
name.</p>
<p>Searches for synonym to species</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">names</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">Full_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pow_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">names</span>,</span>
<span>      <span class="va">powo_searcher</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">pow_res</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">names</span>, <span class="va">pow_res</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="directions-1">Directions<a class="anchor" aria-label="anchor" href="#directions-1"></a>
</h3>
<p>Directions to a parking spot can be acquired from Google Maps;
however this implies the location can be driven to in the first place.
This may require interactive alterations from the user.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SoS_gkey</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"Sos_gkey"</span><span class="op">)</span></span>
<span><span class="va">directions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/directions_grabber.html">directions_grabber</a></span><span class="op">(</span><span class="va">data</span>, api_key <span class="op">=</span> <span class="va">SoS_gkey</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="export-collections">Export collections<a class="anchor" aria-label="anchor" href="#export-collections"></a>
</h2>
<p>We will write these data to Google sheets for our examples.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first ensure the columns are in the same order as google sheets</span></span>
<span></span>
<span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="st">'1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M'</span>,</span>
<span>                        sheet <span class="op">=</span> <span class="st">'Processed - Examples'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">directions</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">processed</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we will add these data onto our final sheet.</span></span>
<span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/sheet_append.html" class="external-link">sheet_append</a></span><span class="op">(</span><span class="st">'1iOQBNeGqRJ3yhA-Sujas3xZ2Aw5rFkktUKv3N_e4o8M'</span>, </span>
<span>             sheet <span class="op">=</span> <span class="st">'Processed - Examples'</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span> </span></code></pre></div>
<p>We can also export collections as either (or both!) a ‘shapefile’ or
KML for use in GIS or GoogleEarth.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/geodata_writer.html">geodata_writer</a></span><span class="op">(</span><span class="va">data</span>, path <span class="op">=</span> <span class="st">'someplace'</span>, </span>
<span>               filename <span class="op">=</span> <span class="st">'Herbarium_Collections_2023'</span>,</span>
<span>               filetype <span class="op">=</span> <span class="st">'kml'</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Reed Clark Benkendorf.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
